<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Streamzy</title>
    <!-- Google Fonts -->
    <link rel="preload" href="https://fonts.cdnfonts.com/css/electroharmonix" as="style" onload="this.rel='stylesheet'">
    <noscript><link href="https://fonts.cdnfonts.com/css/electroharmonix" rel="stylesheet"></noscript>
    <link rel="preload" href="https://fonts.cdnfonts.com/css/sevarothz" as="style" onload="this.rel='stylesheet'">
    <noscript><link href="https://fonts.cdnfonts.com/css/sevarothz" rel="stylesheet"></noscript>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" media="print" onload="this.media='all'">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="icon" type="image/x-icon" href="https://raw.githubusercontent.com/ChocoCooper/Streamzy/refs/heads/main/favicon.ico">
    <link rel="apple-touch-icon" sizes="180x180" href="https://raw.githubusercontent.com/ChocoCooper/Streamzy/refs/heads/main/apple-touch-icon.png">
    <link rel="manifest" href="https://raw.githubusercontent.com/ChocoCooper/Streamzy/refs/heads/main/manifest.json">
    <style>
        /* General Styles */
        :root {
            --primary-color: #2AF598; /* Accent color */
            --secondary-color: #009EFD; /* Secondary accent color */
            --background-color: #121212; /* Dark background */
            --text-color: #e0e0e0; /* Light text */
            --card-bg: #1e1e1e; /* Dark card background */
            --card-hover-shadow: rgba(0, 0, 0, 0.7); /* Darker shadow */
        }

        body {
            background-color: var(--background-color);
            color: var(--text-color);
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            min-height: 100vh;
            margin: 0;
            padding: 10px 20px 60px;
            position: relative;
        }

        /* Title Container */
        .title-container {
            display: flex;
            align-items: center;
            width: 100%;
            max-width: 1200px;
            margin-bottom: 20px;
            text-align: center;
            gap: 10px;
            position: relative;
        }

        /* Title Wrapper */
        .title-wrapper {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        h1 {
            font-family: 'Sevarothz', sans-serif;
            font-size: 3.25rem;
            margin: 0;
            color: var(--primary-color);
            padding: 10px 0;
            width: 100%;
            line-height: 1;
            font-weight: normal;
        }

        footer {
            text-align: center;
            position: absolute;
            bottom: 10px;
            width: 100%;
        }

        .footer-link {
            font-family: 'Electroharmonix', 'Courier New', monospace, Arial, sans-serif;
            font-size: clamp(8px, 1vw, 12px);
            color: var(--primary-color);
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 4px 8px;
            border-radius: 6px;
            transition: color 0.3s ease, transform 0.3s ease, box-shadow 0.3s ease;
        }

        .footer-link:hover {
            color: var(--secondary-color);
            transform: scale(1.05);
            box-shadow: 0 0 8px rgba(0, 255, 204, 0.4);
            opacity: 0.9;
        }

        .github-icon {
            font-size: clamp(10px, 1.2vw, 14px);
        }

        @media (max-width: 768px) {
            .footer-link {
                font-size: clamp(8px, 1.2vw, 10px);
                padding: 3px 6px;
            }
            .github-icon {
                font-size: clamp(8px, 1.5vw, 12px);
            }
        }

        @media (max-width: 480px) {
            .footer-link {
                font-size: clamp(7px, 1.5vw, 9px);
                padding: 2px 5px;
            }
            .github-icon {
                font-size: clamp(7px, 1.8vw, 10px);
            }
        }

        /* Search Container */
        .search-container {
            display: flex;
            width: 100%;
            max-width: 600px;
            align-items: center;
            gap: 8px;
            margin-bottom: 20px;
        }

        .searchBox {
            display: flex;
            flex: 1;
            align-items: center;
            justify-content: space-between;
            gap: 8px;
            background: var(--card-bg);
            border-radius: 50px;
            position: relative;
            height: 40px;
        }

        .searchButton {
            color: var(--text-color);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(90deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            border: 0;
            display: inline-block;
            transition: all 300ms cubic-bezier(.23, 1, 0.32, 1);
        }

        .searchButton:hover {
            background-color: #333;
            box-shadow: var(--card-hover-shadow) 0 10px 20px;
            transform: translateY(-3px);
        }

        .searchButton:active {
            box-shadow: none;
            transform: translateY(0);
        }

        .searchInput {
            border: none;
            background: none;
            outline: none;
            color: var(--text-color);
            font-size: 15px;
            padding: 8px 10px;
            width: 100%;
            height: 100%;
        }

        /* Custom Dropdowns */
        .custom-dropdown {
            position: relative;
            display: inline-block;
            z-index: 1000;
            margin-right: 10px;
        }

        .filter-icon {
            width: 40px;
            height: 40px;
            background: var(--card-bg);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .filter-icon:hover {
            background: #333;
        }

        .filter-icon i {
            color: var(--primary-color);
            font-size: 18px;
        }

        .dropdown-menu {
            display: none;
            position: absolute;
            top: 50px;
            right: 0;
            background: var(--card-bg);
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            min-width: 120px;
            max-height: 200px;
            overflow-y: auto;
            animation: fadeIn 0.3s ease;
            z-index: 1001;
        }

        .dropdown-menu.show {
            display: block;
        }

        .dropdown-item {
            padding: 10px 15px;
            color: var(--text-color);
            font-size: 14px;
            cursor: pointer;
            transition: background 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .dropdown-item:hover {
            background: #333;
        }

        .dropdown-item.active::after {
            content: '';
            display: inline-block;
            width: 8px;
            height: 8px;
            background: var(--primary-color);
            border-radius: 50%;
            margin-left: 10px;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Video Container and Results */
        .video-container {
            margin-top: 80px;
            width: 100%;
            max-width: 800px;
            background: #1c1c1c;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            display: none;
            position: relative;
        }

        .video-wrapper {
            position: relative;
            width: 100%;
            padding-top: 56.25%;
        }

        iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: none;
        }

        .close-button {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.7);
            color: var(--text-color);
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
        }

        .close-button:hover {
            background: rgba(0, 0, 0, 0.9);
        }

        .results {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            margin-top: 20px;
            width: 100%;
            max-width: 1200px;
        }

        .result-item {
            margin: 10px;
            cursor: pointer;
            text-align: center;
            flex: 1 1 200px;
            max-width: 200px;
            background: var(--card-bg);
            border-radius: 10px;
            overflow: hidden;
            transition: transform 0.3s, box-shadow 0.3s;
            outline: none;
        }

        .result-item:focus {
            transform: translateY(-5px);
            box-shadow: var(--card-hover-shadow) 0 10px 20px;
        }

        .result-item:hover {
            transform: translateY(-5px);
            box-shadow: var(--card-hover-shadow) 0 10px 20px;
        }

        .result-item img {
            width: 100%;
            height: auto;
            border-bottom: 2px solid var(--secondary-color);
        }

        .result-item p {
            margin: 5px 0;
            font-size: 14px;
            color: var(--text-color);
        }

        .result-item .release-date {
            font-size: 12px;
            color: #888;
        }

        /* Result Not Found Message */
        .no-results {
            text-align: center;
            font-size: 18px;
            color: var(--text-color);
            margin-top: 20px;
            display: none;
        }

        @media (max-width: 600px) {
            .result-item {
                flex: 1 1 calc(50% - 20px);
                max-width: calc(50% - 20px);
            }
        }

        /* Image Gallery */
        .container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            width: 100%;
            margin-top: -5px;
            max-width: 1200px;
        }

        .gallery-item {
            margin: 10px;
            cursor: pointer;
            text-align: center;
            flex: 1 1 200px;
            max-width: 200px;
            background: var(--card-bg);
            border-radius: 10px;
            overflow: hidden;
            transition: transform 0.3s, box-shadow 0.3s;
            outline: none;
        }

        .gallery-item:focus {
            transform: translateY(-5px);
            box-shadow: var(--card-hover-shadow) 0 10px 20px;
        }

        .gallery-item:hover {
            transform: translateY(-5px);
            box-shadow: var(--card-hover-shadow) 0 10px 20px;
        }

        .gallery-item img {
            width: 100%;
            height: auto;
            border-bottom: 2px solid var(--secondary-color);
        }

        .gallery-item p {
            margin: 5px 0;
            font-size: 14px;
            color: var(--text-color);
        }

        .gallery-item .release-date {
            font-size: 12px;
            color: #888;
        }

        @media (max-width: 600px) {
            .gallery-item {
                flex: 1 1 calc(50% - 20px);
                max-width: calc(50% - 20px);
            }
        }

        /* Toggle Switch */
        .mydict div {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            margin: 20px 0;
        }

        .mydict input[type="radio"] {
            clip: rect(0 0 0 0);
            clip-path: inset(100%);
            height: 1px;
            overflow: hidden;
            position: absolute;
            white-space: nowrap;
            width: 1px;
        }

        .mydict input[type="radio"]:checked + span {
            box-shadow: 0 0 0 0.0625em var(--primary-color);
            background-color: #333;
            z-index: 1;
            color: var(--primary-color);
        }

        label span {
            display: block;
            cursor: pointer;
            background-color: var(--card-bg);
            padding: 0.25em 0.5em;
            position: relative;
            margin-left: 0.0625em;
            box-shadow: 0 0 0 0.0625em #444;
            letter-spacing: 0.05em;
            color: #888;
            text-align: center;
            transition: background-color 0.5s ease;
            font-size: 14px;
        }

        label:first-child span {
            border-radius: 0.375em 0 0 0.375em;
        }

        label:last-child span {
            border-radius: 0 0.375em 0.375em 0;
        }

        .selector-container {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 10px;
            justify-content: center;
            width: 100%;
            max-width: 800px;
        }

        .server-selector-container {
            display: flex;
            justify-content: flex-start;
            align-items: center;
            width: 100%;
            max-width: 800px;
        }

        .season-episode-container {
            display: flex;
            gap: 10px;
            width: 100%;
        }

        /* Styled Select Elements */
        select {
            padding: 6px 24px 6px 10px;
            font-size: 12px;
            border-radius: 4px;
            border: 1px solid #444;
            background-color: #1e1e1e;
            color: var(--text-color);
            cursor: pointer;
            appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23e0e0e0'%3e%3cpath d='M7 10l5 5 5-5z'/%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 8px center;
            background-size: 12px;
            width: 100%;
            min-width: 100px;
            transition: border-color 0.3s ease, background-color 0.3s ease;
        }

        select:hover {
            border-color: #666;
        }

        select:focus {
            outline: none;
            border-color: #888;
        }

        #season-select,
        #episode-select,
        #server-select {
            border-color: var(--primary-color);
            background-color: #1e1e1e;
            color: var(--primary-color);
        }

        @media (max-width: 600px) {
            .selector-container {
                flex-direction: column;
            }

            .season-episode-container {
                flex-direction: row;
                justify-content: center;
            }

            #season-select,
            #episode-select {
                width: 44%;
                margin: 0 -2px;
            }

            #server-select {
                width: 90%;
                margin: 0 auto;
            }
        }

        /* Loading Spinner */
        .loading-spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
            display: none;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Pagination Buttons */
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin-top: 20px;
        }

        .pagination button {
            padding: 6px 12px;
            font-size: 20px;
            text-align: center;
            border-radius: 4px;
            border: 1px solid #444;
            background-color: #1e1e1e;
            color: var(--text-color);
            cursor: pointer;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        .pagination button:hover {
            background-color: #333;
            color: var(--primary-color);
        }

        .pagination button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Back to Gallery Icon Button */
        .back-to-gallery {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 40px;
            height: 40px;
            background: var(--card-bg);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background 0.3s ease;
            z-index: 1000;
        }

        .back-to-gallery:hover {
            background: #333;
        }

        .back-to-gallery i {
            color: var(--primary-color);
            font-size: 18px;
        }

        /* Home Button */
        .home-button {
            display: none;
            width: 40px;
            height: 40px;
            background: transparent;
            border: none;
            cursor: pointer;
            margin: 10px auto;
            z-index: 1000;
        }

        .home-button i {
            color: var(--primary-color);
            font-size: 20px;
            opacity: 0.7;
            transition: opacity 0.3s ease;
        }

        .home-button:hover i {
            opacity: 1;
        }
    </style>
</head>
<body>
    <div class="title-container">
        <!-- Main Title -->
        <div class="title-wrapper">
            <h1>Streamzy</h1>
        </div>
    </div>

    <!-- Search Container -->
    <div class="search-container">
        <div class="searchBox">
            <input class="searchInput" type="text" id="searchQuery" placeholder="Search" />
            <button class="searchButton" id="searchButton">
                <svg xmlns="http://www.w3.org/2000/svg" width="29" height="29" viewBox="0 0 29 29" fill="none">
                    <g clip-path="url(#clip0_2_17)">
                        <g filter="url(#filter0_d_2_17)">
                            <path d="M23.7953 23.9182L19.0585 19.1814M19.0585 19.1814C19.8188 18.4211 20.4219 17.5185 20.8333 16.5251C21.2448 15.5318 21.4566 14.4671 21.4566 13.3919C21.4566 12.3167 21.2448 11.252 20.8333 10.2587C20.4219 9.2653 19.8188 8.36271 19.0585 7.60242C18.2982 6.84214 17.3956 6.23905 16.4022 5.82759C15.4089 5.41612 14.3442 5.20435 13.269 5.20435C12.1938 5.20435 11.1291 5.41612 10.1358 5.82759C9.1424 6.23905 8.23981 6.84214 7.47953 7.60242C5.94407 9.13789 5.08145 11.2204 5.08145 13.3919C5.08145 15.5634 5.94407 17.6459 7.47953 19.1814C9.01499 20.7168 11.0975 21.5794 13.269 21.5794C15.4405 21.5794 17.523 20.7168 19.0585 19.1814Z" stroke="white" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" shape-rendering="crispEdges"></path>
                        </g>
                    </g>
                    <defs>
                        <filter id="filter0_d_2_17" x="-0.418549" y="3.70435" width="29.7139" height="29.7139" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
                            <feFlood flood-opacity="0" result="BackgroundImageFix"></feFlood>
                            <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"></feColorMatrix>
                            <feOffset dy="4"></feOffset>
                            <feGaussianBlur stdDeviation="2"></feGaussianBlur>
                            <feComposite in2="hardAlpha" operator="out"></feComposite>
                            <feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.25 0"></feColorMatrix>
                            <feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow_2_17"></feBlend>
                            <feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow_2_17" result="shape"></feBlend>
                        </filter>
                        <clipPath id="clip0_2_17">
                            <rect width="28.0702" height="28.0702" fill="white" transform="translate(0.403503 0.526367)"></rect>
                        </clipPath>
                    </defs>
                </svg>
            </button>
        </div>
        <!-- Filter Icon and Dropdown Menu -->
        <div class="custom-dropdown" id="filterDropdown">
            <div class="filter-icon">
                <i class="fas fa-filter"></i>
            </div>
            <div class="dropdown-menu" id="dropdownMenu">
                <div class="dropdown-item active" data-value="all">All</div>
                <div class="dropdown-item" data-value="movie">Movies</div>
                <div class="dropdown-item" data-value="tv">Series</div>
            </div>
        </div>
    </div>

    <!-- Toggle Switch -->
    <div class="mydict">
        <div>
            <label>
                <input type="radio" name="radio" checked="" id="moviesToggle" />
                <span>Movies</span>
            </label>
            <label>
                <input type="radio" name="radio" id="seriesToggle" />
                <span>Series</span>
            </label>
            <label>
                <input type="radio" name="radio" id="animeToggle" />
                <span>Anime</span>
            </label>
            <label>
                <input type="radio" name="radio" id="dramaToggle" />
                <span>Drama</span>
            </label>
            <label>
                <input type="radio" name="radio" id="showsToggle" />
                <span>Shows</span>
            </label>
        </div>
    </div>

    <!-- Video Container -->
    <div class="video-container" id="videoContainer">
        <div class="video-wrapper">
            <iframe id="videoFrame" src="" allowfullscreen aria-label="Video Player"></iframe>
        </div>
        <button class="close-button" id="closeButton" aria-label="Close Video">×</button>
    </div>

    <!-- Selector Container -->
    <div class="selector-container" id="selectorContainer" style="display: none;">
        <div class="server-selector-container">
            <select id="server-select" aria-label="Select Server">
                <option value="https://vidsrc.cc/v2" selected>Server 1</option>
                <option value="https://vidsrc.vip">Server 2</option>
                <option value="https://vidsrc.cc/v3">Server 3</option>
                <option value="https://vidsrc.me">Server 4</option>
                <option value="https://www.2embed.cc">Server 5</option>
                <option value="https://vidlink.pro">Server 6</option>
                <option value="https://embed.su">Server 7</option>
                <option value="https://player.smashy.stream">Server 8</option>
                <option value="https://vidfast.pro">Server 9</option>
                <option value="https://111movies.com">Server 10</option>
            </select>
        </div>
        <div class="season-episode-container">
            <select id="season-select" style="display: none;" aria-label="Select Season">
                <option value="">Select Season</option>
            </select>
            <select id="episode-select" style="display: none;" aria-label="Select Episode">
                <option value="">Select Episode</option>
            </select>
        </div>
    </div>

    <!-- Results Container -->
    <div class="results" id="resultsContainer"></div>

    <!-- Result Not Found Message -->
    <div class="no-results" id="noResultsMessage">No results found. Please try a different search.</div>

    <!-- Pagination Buttons -->
    <div class="pagination" id="paginationContainer" style="display: none;">
        <button id="prevPage" disabled>‹</button>
        <span id="pageInfo">Page 1</span>
        <button id="nextPage">›</button>
    </div>

    <!-- Image Gallery -->
    <div id="imageGallery" class="container"></div>

    <!-- Loading Spinner -->
    <div class="loading-spinner" id="loadingSpinner" style="display: none;"></div>

    <!-- Home Button -->
    <button class="home-button" id="homeButton" aria-label="Home">
        <i class="fas fa-home"></i>
    </button>

    <!-- Footer -->
    <footer>
        <a href="https://github.com/ChocoCooper" class="footer-link" target="_blank" aria-label="Visit Choco Cooper's GitHub Profile">
            © Choco Cooper
            <i class="fa-brands fa-github github-icon" aria-hidden="true"></i>
        </a>
    </footer>

    <script>
        const resultsContainer = document.getElementById('resultsContainer');
        const videoFrame = document.getElementById('videoFrame');
        const videoContainer = document.getElementById('videoContainer');
        const searchQueryInput = document.getElementById('searchQuery');
        const searchButton = document.getElementById('searchButton');
        const imageContainer = document.getElementById('imageGallery');
        const closeButton = document.getElementById('closeButton');
        const moviesToggle = document.getElementById('moviesToggle');
        const seriesToggle = document.getElementById('seriesToggle');
        const animeToggle = document.getElementById('animeToggle');
        const dramaToggle = document.getElementById('dramaToggle');
        const showsToggle = document.getElementById('showsToggle');
        const filterDropdown = document.getElementById('filterDropdown');
        const dropdownMenu = document.getElementById('dropdownMenu');
        const selectorContainer = document.getElementById('selectorContainer');
        const seasonSelect = document.getElementById('season-select');
        const episodeSelect = document.getElementById('episode-select');
        const serverSelect = document.getElementById('server-select');
        const toggleContainer = document.querySelector('.mydict');
        const loadingSpinner = document.getElementById('loadingSpinner');
        const paginationContainer = document.getElementById('paginationContainer');
        const prevPageButton = document.getElementById('prevPage');
        const nextPageButton = document.getElementById('nextPage');
        const pageInfo = document.getElementById('pageInfo');
        const homeButton = document.getElementById('homeButton');
        const noResultsMessage = document.getElementById('noResultsMessage');

        let currentMediaType = 'movie';
        let currentMediaId = null;
        let currentPage = 1;
        let totalPages = 1;
        const resultsPerPage = 12;

        // Initialize the app based on URL
        document.addEventListener('DOMContentLoaded', () => {
            const urlParams = new URLSearchParams(window.location.search);
            const searchQuery = urlParams.get('s');
            const tmdbId = window.location.pathname.split('/').pop();
            
            if (searchQuery) {
                searchQueryInput.value = decodeURIComponent(searchQuery);
                search();
            } else if (tmdbId && !isNaN(tmdbId)) {
                loadMediaItemDirectly(tmdbId);
            } else {
                fetchTrending('movie');
            }
        });

        // Handle browser back/forward navigation
        window.addEventListener('popstate', () => {
            const urlParams = new URLSearchParams(window.location.search);
            const searchQuery = urlParams.get('s');
            const tmdbId = window.location.pathname.split('/').pop();
            
            if (searchQuery) {
                searchQueryInput.value = decodeURIComponent(searchQuery);
                search();
            } else if (tmdbId && !isNaN(tmdbId)) {
                loadMediaItemDirectly(tmdbId);
            } else {
                // Home page
                videoContainer.style.display = 'none';
                videoFrame.src = '';
                hideSelectors();
                imageContainer.style.display = 'flex';
                showToggle();
                resetDropdowns();
                homeButton.style.display = 'none';
                paginationContainer.style.display = 'none';
                resultsContainer.innerHTML = '';
                searchQueryInput.value = '';
            }
        });

        // Load media item directly from URL
        async function loadMediaItemDirectly(tmdbId) {
            const apiKey = 'ea118e768e75a1fe3b53dc99c9e4de09';
            try {
                // First try as movie
                let response = await fetch(`https://api.themoviedb.org/3/movie/${tmdbId}?api_key=${apiKey}`);
                let data = await response.json();
                
                if (data.success === false) {
                    // If not movie, try as TV show
                    response = await fetch(`https://api.themoviedb.org/3/tv/${tmdbId}?api_key=${apiKey}`);
                    data = await response.json();
                    if (data.success === false) {
                        throw new Error('Media not found');
                    }
                    handleSeriesClick(tmdbId, 'tv');
                } else {
                    handleSeriesClick(tmdbId, 'movie');
                }
            } catch (error) {
                console.error('Error loading media:', error);
                window.location.href = '/';
            }
        }

        // Navigate to media item page
        function navigateToMedia(tmdbId, mediaType) {
            window.history.pushState({}, '', `/${tmdbId}`);
            
            if (mediaType === 'movie') {
                handleSeriesClick(tmdbId, 'movie');
            } else {
                handleSeriesClick(tmdbId, mediaType);
            }
        }

        // Show the image gallery initially
        imageContainer.style.display = 'flex';

        // Hide the video frame initially
        videoContainer.style.display = 'none';

        // Hide toggle container when searching or video is playing
        function hideToggle() {
            toggleContainer.style.display = 'none';
        }

        // Show toggle container when displaying the image gallery
        function showToggle() {
            toggleContainer.style.display = 'block';
        }

        // Hide selectors when Movies toggle is selected
        function hideSelectors() {
            selectorContainer.style.display = 'none';
            seasonSelect.style.display = 'none';
            episodeSelect.style.display = 'none';
        }

        // Show selectors when Series or Anime toggle is selected
        function showSelectors() {
            selectorContainer.style.display = 'flex';
            if (currentMediaType === 'tv' || currentMediaType === 'anime' || currentMediaType === 'drama' || currentMediaType === 'shows') {
                seasonSelect.style.display = 'block';
                episodeSelect.style.display = 'block';
            } else {
                seasonSelect.style.display = 'none';
                episodeSelect.style.display = 'none';
            }
        }

        // Clear the search bar text
        function clearSearchText() {
            searchQueryInput.value = '';
        }

        // Reset dropdowns to default states
        function resetDropdowns() {
            seasonSelect.innerHTML = '<option value="">Select Season</option>';
            episodeSelect.innerHTML = '<option value="">Select Episode</option>';
            serverSelect.value = 'https://vidsrc.cc/v2';
        }

        // Handle clicking on a series
        function handleSeriesClick(mediaId, mediaType) {
            currentMediaId = mediaId;
            currentMediaType = mediaType;
            resetDropdowns();
            videoFrame.src = '';
            videoContainer.style.display = 'block';

            serverSelect.value = 'https://vidsrc.cc/v2';

            if (mediaType === 'movie') {
                embedVideo(mediaId, 'movie');
            } else if (mediaType === 'tv' || mediaType === 'anime' || currentMediaType === 'drama' || currentMediaType === 'shows') {
                fetchSeasons(mediaId);
            }

            showSelectors();
            imageContainer.style.display = 'none';
            homeButton.style.display = 'block';
            paginationContainer.style.display = 'none';
            hideToggle();
        }

        // Add event listener for home button
        homeButton.addEventListener('click', () => {
            window.history.pushState({}, '', '/');
            videoContainer.style.display = 'none';
            videoFrame.src = '';
            hideSelectors();
            imageContainer.style.display = 'flex';
            showToggle();
            resetDropdowns();
            homeButton.style.display = 'none';
            paginationContainer.style.display = 'none';
        });

        // Add event listener for Enter key
        searchQueryInput.addEventListener('keypress', function(event) {
            if (event.key === 'Enter') {
                hideToggle();
                search();
            }
        });

        // Add event listener for search button
        searchButton.addEventListener('click', () => {
            hideToggle();
            search();
        });

        // Add event listener for close button
        closeButton.addEventListener('click', () => {
            window.history.pushState({}, '', '/');
            videoContainer.style.display = 'none';
            videoFrame.src = '';
            hideSelectors();
            imageContainer.style.display = 'flex';
            showToggle();
            resetDropdowns();
            homeButton.style.display = 'none';
            paginationContainer.style.display = 'none';
        });

        // Add event listeners for toggle switches
        moviesToggle.addEventListener('change', () => {
            if (moviesToggle.checked) {
                currentMediaType = 'movie';
                hideSelectors();
                fetchTrending('movie');
            }
        });

        seriesToggle.addEventListener('change', () => {
            if (seriesToggle.checked) {
                currentMediaType = 'tv';
                fetchTrending('tv');
            }
        });

        animeToggle.addEventListener('change', () => {
            if (animeToggle.checked) {
                currentMediaType = 'anime';
                fetchTrending('anime');
            }
        });

        dramaToggle.addEventListener('change', () => {
            if (dramaToggle.checked) {
                currentMediaType = 'drama';
                fetchTrending('drama');
            }
        });

        showsToggle.addEventListener('change', () => {
            if (showsToggle.checked) {
                currentMediaType = 'shows';
                fetchTrending('shows');
            }
        });

        // Add event listener for filter dropdown
        filterDropdown.addEventListener('click', (event) => {
            event.stopPropagation();
            dropdownMenu.classList.toggle('show');
        });

        // Close dropdown when clicking outside
        document.addEventListener('click', (event) => {
            if (!filterDropdown.contains(event.target)) {
                dropdownMenu.classList.remove('show');
            }
        });

        // Handle dropdown item selection
        dropdownMenu.querySelectorAll('.dropdown-item').forEach(item => {
            item.addEventListener('click', () => {
                dropdownMenu.querySelectorAll('.dropdown-item').forEach(i => {
                    i.classList.remove('active');
                });

                item.classList.add('active');
                dropdownMenu.classList.remove('show');
                currentPage = 1;
                const query = searchQueryInput.value.trim();
                if (query) {
                    search();
                }
            });
        });

        // Add event listener for season selection
        seasonSelect.addEventListener('change', async () => {
            const seasonNumber = seasonSelect.value;
            if (seasonNumber && currentMediaId) {
                await fetchEpisodes(currentMediaId, seasonNumber);
            }
        });

        // Add event listener for episode selection
        episodeSelect.addEventListener('change', () => {
            const episodeNumber = episodeSelect.value;
            if (episodeNumber && currentMediaId) {
                const seasonNumber = seasonSelect.value;
                embedVideo(currentMediaId, currentMediaType, seasonNumber, episodeNumber);
            }
        });

        // Add event listener for server selection
        serverSelect.addEventListener('change', () => {
            if (currentMediaId) {
                if (currentMediaType === 'movie') {
                    embedVideo(currentMediaId, 'movie');
                } else if (currentMediaType === 'tv' || currentMediaType === 'anime' || currentMediaType === 'drama' || currentMediaType === 'shows') {
                    embedVideo(currentMediaId, 'tv', seasonSelect.value, episodeSelect.value);
                }
            }
        });

        // Add event listeners for pagination buttons
        prevPageButton.addEventListener('click', () => {
            if (currentPage > 1) {
                currentPage--;
                search();
            }
        });

        nextPageButton.addEventListener('click', () => {
            if (currentPage < totalPages) {
                currentPage++;
                search();
            }
        });

        // Function to fetch trending content
        async function fetchTrending(mediaType) {
            const apiKey = 'ea118e768e75a1fe3b53dc99c9e4de09';
            let url;

            if (mediaType === 'movie') {
                url = `https://api.themoviedb.org/3/trending/movie/day?api_key=${apiKey}`;
            } else if (mediaType === 'tv') {
                url = `https://api.themoviedb.org/3/trending/tv/day?api_key=${apiKey}`;
            } else if (mediaType === 'anime') {
                url = `https://api.themoviedb.org/3/discover/tv?api_key=${apiKey}&with_genres=16&sort_by=popularity.desc&with_original_language=ja`;
            } else if (mediaType === 'drama') {
                url = `https://api.themoviedb.org/3/discover/tv?api_key=${apiKey}&with_genres=18&sort_by=popularity.desc&with_original_language=ko|zh`;
            } else if (mediaType === 'shows') {
                url = `https://api.themoviedb.org/3/discover/tv?api_key=${apiKey}&with_genres=10764&sort_by=popularity.desc&with_original_language=en`;
            }

            try {
                const response = await fetch(url);
                const data = await response.json();
                const trendingContent = data.results || [];

                imageContainer.innerHTML = '';

                const limitedContent = trendingContent.slice(0, 12);

                limitedContent.forEach(item => {
                    const imageUrl = item.poster_path ? `https://image.tmdb.org/t/p/w500${item.poster_path}` : null;
                    if (imageUrl) {
                        const itemDiv = document.createElement('div');
                        itemDiv.className = 'gallery-item';
                        itemDiv.tabIndex = 0;
                        itemDiv.innerHTML = `
                            <img src="${imageUrl}" alt="${item.title || item.name}" />
                            <p>${item.title || item.name}</p>
                            <p class="release-date">(${new Date(item.release_date || item.first_air_date).getFullYear()})</p>
                        `;
                        itemDiv.onclick = () => {
                            const mediaType = mediaType || 'movie';
                            navigateToMedia(item.id, mediaType);
                        };
                        itemDiv.addEventListener('keydown', (event) => {
                            if (event.key === 'Enter') {
                                const mediaType = mediaType || 'movie';
                                navigateToMedia(item.id, mediaType);
                            }
                        });
                        imageContainer.appendChild(itemDiv);
                    }
                });
            } catch (error) {
                console.error('Error fetching trending content:', error);
            }
        }

        // Function to handle search
        async function search() {
            const query = searchQueryInput.value.trim();
            resultsContainer.innerHTML = '';
            noResultsMessage.style.display = 'none';

            videoContainer.style.display = 'none';
            hideSelectors();

            if (!query) {
                imageContainer.style.display = 'flex';
                showToggle();
                return;
            }

            const apiKey = 'ea118e768e75a1fe3b53dc99c9e4de09';
            const selectedFilter = dropdownMenu.querySelector('.dropdown-item.active')?.getAttribute('data-value') || 'all';

            // Update URL with search query
            window.history.pushState({}, '', `/?s=${encodeURIComponent(query)}`);

            loadingSpinner.style.display = 'block';

            let movieUrl, seriesUrl, animeUrl, dramaUrl, showsUrl;
            if (selectedFilter === 'all') {
                movieUrl = `https://api.themoviedb.org/3/search/movie?api_key=${apiKey}&query=${encodeURIComponent(query)}&page=${currentPage}`;
                seriesUrl = `https://api.themoviedb.org/3/search/tv?api_key=${apiKey}&query=${encodeURIComponent(query)}&page=${currentPage}`;
                animeUrl = `https://api.themoviedb.org/3/search/tv?api_key=${apiKey}&query=${encodeURIComponent(query)}&with_genres=16&with_original_language=ja&page=${currentPage}`;
                dramaUrl = `https://api.themoviedb.org/3/search/tv?api_key=${apiKey}&query=${encodeURIComponent(query)}&with_genres=18&with_original_language=ko|zh&page=${currentPage}`;
                showsUrl = `https://api.themoviedb.org/3/search/tv?api_key=${apiKey}&query=${encodeURIComponent(query)}&with_genres=10764&with_original_language=en&page=${currentPage}`;
            } else if (selectedFilter === 'movie') {
                movieUrl = `https://api.themoviedb.org/3/search/movie?api_key=${apiKey}&query=${encodeURIComponent(query)}&page=${currentPage}`;
            } else if (selectedFilter === 'tv') {
                seriesUrl = `https://api.themoviedb.org/3/search/tv?api_key=${apiKey}&query=${encodeURIComponent(query)}&page=${currentPage}`;
            }

            try {
                const [movieResponse, seriesResponse, animeResponse, dramaResponse, showsResponse] = await Promise.all([
                    movieUrl ? fetch(movieUrl) : Promise.resolve(null),
                    seriesUrl ? fetch(seriesUrl) : Promise.resolve(null),
                    animeUrl ? fetch(animeUrl) : Promise.resolve(null),
                    dramaUrl ? fetch(dramaUrl) : Promise.resolve(null),
                    showsUrl ? fetch(showsUrl) : Promise.resolve(null),
                ]);

                const movieData = movieResponse ? await movieResponse.json() : { results: [] };
                const seriesData = seriesResponse ? await seriesResponse.json() : { results: [] };
                const animeData = animeResponse ? await animeResponse.json() : { results: [] };
                const dramaData = dramaResponse ? await dramaResponse.json() : { results: [] };
                const showsData = showsResponse ? await showsResponse.json() : { results: [] };

                const combinedResults = [
                    ...movieData.results.map(result => ({ ...result, mediaType: 'movie' })),
                    ...seriesData.results.map(result => ({ ...result, mediaType: 'tv' })),
                    ...animeData.results.map(result => ({ ...result, mediaType: 'anime' })),
                    ...dramaData.results.map(result => ({ ...result, mediaType: 'drama' })),
                    ...showsData.results.map(result => ({ ...result, mediaType: 'shows' })),
                ];

                const uniqueResults = [];
                const seenIds = new Set();

                combinedResults.forEach(result => {
                    if (!seenIds.has(result.id)) {
                        seenIds.add(result.id);
                        uniqueResults.push(result);
                    }
                });

                const filteredResults = uniqueResults.filter(result => {
                    const hasTitle = result.title || result.name;
                    const hasPoster = result.poster_path;
                    const year = new Date(result.release_date || result.first_air_date).getFullYear();
                    return hasTitle && hasPoster && !isNaN(year);
                });

                if (filteredResults.length === 0) {
                    resultsContainer.innerHTML = '';
                    imageContainer.style.display = 'none';
                    noResultsMessage.style.display = 'block';
                    return;
                }

                imageContainer.style.display = 'none';

                totalPages = Math.ceil(filteredResults.length / resultsPerPage);

                if (currentPage > totalPages) {
                    currentPage = totalPages;
                }

                const startIndex = (currentPage - 1) * resultsPerPage;
                const endIndex = startIndex + resultsPerPage;
                let paginatedResults = filteredResults.slice(startIndex, endIndex);

                if (paginatedResults.length < resultsPerPage && currentPage < totalPages) {
                    const nextPage = currentPage + 1;
                    const nextPageUrl = `https://api.themoviedb.org/3/search/multi?api_key=${apiKey}&query=${encodeURIComponent(query)}&page=${nextPage}`;
                    const nextPageResponse = await fetch(nextPageUrl);
                    const nextPageData = await nextPageResponse.json();

                    const additionalResults = nextPageData.results
                        .filter(result => {
                            const hasTitle = result.title || result.name;
                            const hasPoster = result.poster_path;
                            const year = new Date(result.release_date || result.first_air_date).getFullYear();
                            return hasTitle && hasPoster && !isNaN(year);
                        })
                        .slice(0, resultsPerPage - paginatedResults.length);

                    paginatedResults = [...paginatedResults, ...additionalResults];
                }

                paginatedResults.forEach(result => {
                    const item = document.createElement('div');
                    item.className = 'gallery-item';
                    item.tabIndex = 0;
                    const imageUrl = result.poster_path ? `https://image.tmdb.org/t/p/w500${result.poster_path}` : null;
                    if (imageUrl) {
                        item.innerHTML = `
                            <img src="${imageUrl}" alt="${result.title || result.name}" />
                            <p>${result.title || result.name}</p>
                            <p class="release-date">(${new Date(result.release_date || result.first_air_date).getFullYear()})</p>
                        `;
                        item.onclick = () => {
                            clearSearchText();
                            navigateToMedia(result.id, result.mediaType);
                            resultsContainer.innerHTML = '';
                            videoContainer.scrollIntoView({ behavior: 'smooth' });
                        };
                        item.addEventListener('keydown', (event) => {
                            if (event.key === 'Enter') {
                                clearSearchText();
                                navigateToMedia(result.id, result.mediaType);
                                resultsContainer.innerHTML = '';
                                videoContainer.scrollIntoView({ behavior: 'smooth' });
                            }
                        });
                        resultsContainer.appendChild(item);
                    }
                });

                updatePagination();
                paginationContainer.style.display = 'flex';
            } catch (error) {
                console.error('Error fetching data:', error);
                resultsContainer.innerHTML = '';
            } finally {
                loadingSpinner.style.display = 'none';
            }
        }

        // Function to update pagination buttons
        function updatePagination() {
            paginationContainer.style.display = totalPages > 1 ? 'flex' : 'none';
            pageInfo.textContent = `Page ${currentPage}`;
            prevPageButton.disabled = currentPage === 1;
            nextPageButton.disabled = currentPage === totalPages;
        }

        // Function to embed video
        function embedVideo(mediaId, mediaType, seasonNumber = null, episodeNumber = null) {
            hideToggle();
            const selectedServer = serverSelect.value;
            let embedUrl;

            if (mediaType === 'movie') {
                switch (selectedServer) {
                    case 'https://www.2embed.stream':
                        embedUrl = `${selectedServer}/embed/movie/${mediaId}`;
                        break;
                    case 'https://www.2embed.cc':
                        embedUrl = `${selectedServer}/embed/${mediaId}`;
                        break;
                    case 'https://vidsrc.cc/v2':
                    case 'https://vidsrc.cc/v3':
                        embedUrl = `${selectedServer}/embed/movie/${mediaId}`;
                        break;
                    case 'https://vidlink.pro':
                        embedUrl = `${selectedServer}/movie/${mediaId}`;
                        break;
                    case 'https://embed.su':
                        embedUrl = `${selectedServer}/embed/movie/${mediaId}`;
                        break;
                    case 'https://player.smashy.stream':
                        embedUrl = `${selectedServer}/movie/${mediaId}`;
                        break;
                    case 'https://vidfast.pro':
                        embedUrl = `${selectedServer}/movie/${mediaId}`;
                        break;
                    case 'https://111movies.com':
                        embedUrl = `${selectedServer}/movie/${mediaId}`;
                        break;
                    default:
                        embedUrl = `${selectedServer}/embed/${mediaType}/${mediaId}`;
                        break;
                }
            } else if (mediaType === 'tv' && seasonNumber && episodeNumber) {
                switch (selectedServer) {
                    case 'https://www.2embed.stream':
                        embedUrl = `${selectedServer}/embed/tv/${mediaId}/${seasonNumber}/${episodeNumber}`;
                        break;
                    case 'https://www.2embed.cc':
                        embedUrl = `${selectedServer}/embedtv/${mediaId}&s=${seasonNumber}&e=${episodeNumber}`;
                        break;
                    case 'https://vidsrc.cc/v2':
                    case 'https://vidsrc.cc/v3':
                        embedUrl = `${selectedServer}/embed/tv/${mediaId}/${seasonNumber}/${episodeNumber}`;
                        break;
                    case 'https://vidlink.pro':
                        embedUrl = `${selectedServer}/tv/${mediaId}/${seasonNumber}/${episodeNumber}`;
                        break;
                    case 'https://embed.su':
                        embedUrl = `${selectedServer}/embed/tv/${mediaId}/${seasonNumber}/${episodeNumber}`;
                        break;
                    case 'https://player.smashy.stream':
                        embedUrl = `${selectedServer}/tv/${mediaId}?s=${seasonNumber}&e=${episodeNumber}`;
                        break;
                    case 'https://vidfast.pro':
                        embedUrl = `${selectedServer}/tv/${mediaId}/${seasonNumber}/${episodeNumber}`;
                        break;
                    case 'https://111movies.com':
                        embedUrl = `${selectedServer}/tv/${mediaId}/${seasonNumber}/${episodeNumber}`;
                        break;
                    default:
                        embedUrl = `${selectedServer}/embed/${mediaType}/${mediaId}/${seasonNumber}/${episodeNumber}`;
                        break;
                }
            } else {
                videoFrame.src = '';
                videoContainer.style.display = 'block';
                return;
            }

            videoFrame.src = embedUrl;
            videoContainer.style.display = 'block';
            resultsContainer.innerHTML = '';
        }

        async function fetchSeasons(mediaId) {
            const apiKey = 'ea118e768e75a1fe3b53dc99c9e4de09';
            const url = `https://api.themoviedb.org/3/tv/${mediaId}?api_key=${apiKey}`;

            try {
                const response = await fetch(url);
                const data = await response.json();
                const seasons = data.seasons || [];

                seasonSelect.innerHTML = '<option value="">Select Season</option>';
                seasons.forEach(season => {
                    if (season.season_number > 0) {
                        const option = document.createElement('option');
                        option.value = season.season_number;
                        option.textContent = `Season ${season.season_number}`;
                        seasonSelect.appendChild(option);
                    }
                });

                showSelectors();
            } catch (error) {
                console.error('Error fetching seasons:', error);
            }
        }

        async function fetchEpisodes(mediaId, seasonNumber) {
            const apiKey = 'ea118e768e75a1fe3b53dc99c9e4de09';
            const url = `https://api.themoviedb.org/3/tv/${mediaId}/season/${seasonNumber}?api_key=${apiKey}`;

            try {
                const response = await fetch(url);
                const data = await response.json();
                const episodes = data.episodes || [];

                episodeSelect.innerHTML = '<option value="">Select Episode</option>';
                episodes.forEach(episode => {
                    const option = document.createElement('option');
                    option.value = episode.episode_number;
                    option.textContent = `Episode ${episode.episode_number}`;
                    episodeSelect.appendChild(option);
                });
            } catch (error) {
                console.error('Error fetching episodes:', error);
            }
        }
    </script>
</body>
</html>
