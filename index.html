<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Streamzy</title>
    <link rel="preload" href="https://fonts.cdnfonts.com/css/electroharmonix" as="style" onload="this.rel='stylesheet'">
    <noscript><link href="https://fonts.cdnfonts.com/css/electroharmonix" rel="stylesheet"></noscript>
    <link rel="preload" href="https://cdn.jsdelivr.net/gh/ChocoCooper/Streamzy@main/Sevarothz.woff2" as="font" type="font/woff2" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" media="print" onload="this.media='all'">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="icon" type="image/x-icon" href="https://raw.githubusercontent.com/ChocoCooper/Streamzy/refs/heads/main/favicon.ico">
    <link rel="apple-touch-icon" sizes="180x180" href="https://raw.githubusercontent.com/ChocoCooper/Streamzy/refs/heads/main/apple-touch-icon.png">
    <link rel="manifest" href="https://raw.githubusercontent.com/ChocoCooper/Streamzy/refs/heads/main/manifest.json">
    <style>
        @font-face {
           font-family: 'Sevarothz';
           src: url('https://cdn.jsdelivr.net/gh/ChocoCooper/Streamzy@main/Sevarothz.woff2') format('woff2');
           font-weight: normal;
           font-style: normal;
           font-display: block;
           size-adjust: 125%;
        }
        
        :root {
            --primary-color: #2AF598;
            --secondary-color: #009EFD;
            --background-color: #121212;
            --text-color: #e0e0e0;
            --card-bg: #1e1e1e;
            --card-hover-shadow: rgba(0, 0, 0, 0.7);
        }

        body {
            background-color: var(--background-color);
            color: var(--text-color);
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            min-height: 100vh;
            margin: 0;
            padding: 10px 20px 60px;
            position: relative;
        }

        .title-container {
            display: flex;
            align-items: center;
            width: 100%;
            max-width: 1200px;
            margin-bottom: 10px;
            text-align: center;
            gap: 10px;
            position: relative;
        }

        .title-wrapper {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        h1 {
            font-family: 'Sevarothz', sans-serif;
            margin: 20px;
            line-height: 1;
            color: var(--primary-color);
            font-weight: normal;
        }

        .search-container {
            display: flex;
            width: 100%;
            max-width: 600px;
            align-items: center;
            gap: 8px;
            margin-bottom: 20px;
        }

        .searchBox {
            display: flex;
            flex: 1;
            align-items: center;
            justify-content: space-between;
            gap: 8px;
            background: var(--card-bg);
            border-radius: 50px;
            position: relative;
            height: 40px;
        }

        .searchButton {
            color: var(--text-color);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(90deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            border: 0;
            display: inline-block;
            transition: all 300ms cubic-bezier(.23, 1, 0.32, 1);
        }

        .searchButton:hover {
            background-color: #333;
            box-shadow: var(--card-hover-shadow) 0 10px 20px;
            transform: translateY(-3px);
        }

        .searchInput {
            border: none;
            background: none;
            outline: none;
            color: var(--text-color);
            font-size: 15px;
            padding: 8px 10px;
            width: 100%;
            height: 100%;
        }

        .custom-dropdown {
            position: relative;
            display: inline-block;
            z-index: 1000;
            margin-right: 10px;
        }

        .filter-icon {
            width: 40px;
            height: 40px;
            background: var(--card-bg);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .filter-icon:hover {
            background: #333;
        }

        .filter-icon i {
            color: var(--primary-color);
            font-size: 18px;
        }

        .dropdown-menu {
            display: none;
            position: absolute;
            top: 50px;
            right: 0;
            background: var(--card-bg);
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            min-width: 120px;
            max-height: 200px;
            overflow-y: auto;
            animation: fadeIn 0.3s ease;
            z-index: 1001;
        }

        .dropdown-menu.show {
            display: block;
        }

        .dropdown-item {
            padding: 10px 15px;
            color: var(--text-color);
            font-size: 14px;
            cursor: pointer;
            transition: background 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .dropdown-item:hover {
            background: #333;
        }

        .dropdown-item.active::after {
            content: '';
            display: inline-block;
            width: 8px;
            height: 8px;
            background: var(--primary-color);
            border-radius: 50%;
            margin-left: 10px;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .video-container {
            margin-top: 20px;
            width: 100%;
            max-width: 100%;
            background: #1c1c1c;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            display: none;
            position: relative;
        }

        .video-wrapper {
            position: relative;
            padding-bottom: 56.25%;
            height: 0;
            overflow: hidden;
        }

        iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: none;
        }

        .close-button {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.7);
            color: var(--text-color);
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
        }

        .results {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            width: 100%;
            max-width: 1200px;
            margin-top: 20px;
        }

        .result-item {
            cursor: pointer;
            text-align: center;
            background: var(--card-bg);
            border-radius: 10px;
            overflow: hidden;
            transition: transform 0.3s, box-shadow 0.3s;
            outline: none;
        }

        .result-item:focus {
            transform: translateY(-5px);
            box-shadow: var(--card-hover-shadow) 0 10px 20px;
        }

        .result-item:hover {
            transform: translateY(-5px);
            box-shadow: var(--card-hover-shadow) 0 10px 20px;
        }

        .result-item img {
            width: 100%;
            height: auto;
            border-bottom: 2px solid var(--secondary-color);
        }

        .result-item p {
            margin: 5px 10px;
            font-size: 15px;
            color: var(--text-color);
        }

        .result-item .release-date {
            font-size: 12px;
            margin-bottom: 10px;
            color: #888;
        }

        .no-results {
            text-align: center;
            font-size: 18px;
            color: var(--text-color);
            margin-top: 20px;
            display: none;
        }

        .container {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            width: 100%;
            margin-top: -5px;
            max-width: 1200px;
        }

        .gallery-item {
            cursor: pointer;
            text-align: center;
            background: var(--card-bg);
            border-radius: 10px;
            overflow: hidden;
            transition: transform 0.3s, box-shadow 0.3s;
            outline: none;
        }

        .gallery-item:focus {
            transform: translateY(-5px);
            box-shadow: var(--card-hover-shadow) 0 10px 20px;
        }

        .gallery-item:hover {
            transform: translateY(-5px);
            box-shadow: var(--card-hover-shadow) 0 10px 20px;
        }

        .gallery-item img {
            width: 100%;
            height: auto;
            border-bottom: 2px solid var(--secondary-color);
        }

        .gallery-item p {
            margin: 5px 10px;
            font-size: 15px;
            color: var(--text-color);
        }

        .gallery-item .release-date {
            font-size: 12px;
            margin-bottom: 10px;
            color: #888;
        }

        .mydict div {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            margin: 20px 0;
        }

        .mydict input[type="radio"] {
            clip: rect(0 0 0 0);
            clip-path: inset(100%);
            height: 1px;
            overflow: hidden;
            position: absolute;
            white-space: nowrap;
            width: 1px;
        }

        .mydict input[type="radio"]:checked + span {
            box-shadow: 0 0 0 0.0625em var(--primary-color);
            background-color: #333;
            z-index: 1;
            color: var(--primary-color);
        }

        label span {
            display: block;
            cursor: pointer;
            background-color: var(--card-bg);
            padding: 0.25em 0.5em;
            position: relative;
            margin-left: 0.0625em;
            box-shadow: 0 0 0 0.0625em #444;
            letter-spacing: 0.05em;
            color: #888;
            text-align: center;
            transition: background-color 0.5s ease;
            font-size: 14px;
        }

        label:first-child span {
            border-radius: 0.375em 0 0 0.375em;
        }

        label:last-child span {
            border-radius: 0 0.375em 0.375em 0;
        }

        .selector-container {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 10px;
            justify-content: center;
            width: 100%;
            max-width: 800px;
        }

        .server-selector-container {
            display: flex;
            justify-content: flex-start;
            align-items: center;
            width: 100%;
            max-width: 800px;
        }

        .season-episode-container {
            display: flex;
            gap: 10px;
            width: 100%;
        }

        select {
            padding: 6px 24px 6px 10px;
            font-size: 12px;
            border-radius: 4px;
            border: 1px solid #444;
            background-color: var(--card-bg);
            color: var(--primary-color);
            cursor: pointer;
            appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%232AF598'%3e%3cpath d='M7 10l5 5 5-5z'/%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 8px center;
            background-size: 12px;
            width: 100%;
            min-width: 100px;
            transition: all 0.3s ease;
        }
        
        select:hover {
           border-color: var(--primary-color);
           outline: none;
        }

        select:focus {
            outline: none;
            box-shadow: none;
        }

        option {
            background-color: var(--card-bg);
            color: var(--text-color);
        }

        .loading-spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
            display: none;
        }

        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin-top: 20px;
        }

        .pagination button {
            padding: 6px 12px;
            font-size: 20px;
            text-align: center;
            border-radius: 4px;
            border: 1px solid #444;
            background-color: #1e1e1e;
            color: var(--primary-color);
            cursor: pointer;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        .pagination button:hover {
            background-color: #333;
            color: var(--primary-color);
        }

        .pagination button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            color: #888;
        }

        .home-button {
            display: none;
            width: 40px;
            height: 40px;
            background: transparent;
            border: none;
            cursor: pointer;
            margin: 10px auto;
            z-index: 1000;
        }

        .home-button i {
            color: var(--primary-color);
            font-size: 20px;
            opacity: 0.7;
            transition: opacity 0.3s ease;
        }

        .home-button:hover i {
            opacity: 1;
        }

        footer {
            text-align: center;
            position: absolute;
            bottom: 10px;
            width: 100%;
        }

        .footer-link {
            font-family: 'Electroharmonix', 'Courier New', monospace, Arial, sans-serif;
            font-size: clamp(8px, 1vw, 12px);
            color: var(--primary-color);
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 4px 8px;
            border-radius: 6px;
            transition: color 0.3s ease, transform 0.3s ease, box-shadow 0.3s ease;
        }

        @media (max-width: 768px) {
            .results, .container {
                grid-template-columns: repeat(2, 1fr);
            }
            
            h1 {
                font-size: 4rem;
            }
        }

        @media (max-width: 480px) {
            h1 {
                font-size: 3rem;
            }
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="title-container">
        <div class="title-wrapper">
            <h1>Streamzy</h1>
        </div>
    </div>

    <div class="search-container">
        <div class="searchBox">
            <input class="searchInput" type="text" id="searchQuery" placeholder="Search" />
            <button class="searchButton" id="searchButton">
                <svg xmlns="http://www.w3.org/2000/svg" width="29" height="29" viewBox="0 0 29 29" fill="none">
                    <g clip-path="url(#clip0_2_17)">
                        <g filter="url(#filter0_d_2_17)">
                            <path d="M23.7953 23.9182L19.0585 19.1814M19.0585 19.1814C19.8188 18.4211 20.4219 17.5185 20.8333 16.5251C21.2448 15.5318 21.4566 14.4671 21.4566 13.3919C21.4566 11.3167 21.2448 10.252 20.8333 9.2587C20.4219 8.2653 19.8188 7.36271 19.0585 6.60242C18.2982 6.84214 17.3956 6.23905 16.4022 5.82759C15.4089 5.41612 14.3442 5.20435 13.269 5.20435C12.1938 5.20435 11.1291 5.41612 10.1358 5.82759C9.1424 6.23905 8.23981 6.84214 7.47953 7.60242C5.94407 9.13789 5.08145 11.2204 5.08145 13.3919C5.08145 15.5634 5.94407 17.6459 7.47953 19.1814C9.01499 20.7168 11.0975 21.5794 13.269 21.5794C15.4405 21.5794 17.523 20.7168 19.0585 19.1814Z" stroke="white" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" shape-rendering="crispEdges"></path>
                        </g>
                    </g>
                    <defs>
                        <filter id="filter0_d_2_17" x="-0.418549" y="3.70435" width="29.7139" height="29.7139" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
                            <feFlood flood-opacity="0" result="BackgroundImageFix"></feFlood>
                            <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"></feColorMatrix>
                            <feOffset dy="4"></feOffset>
                            <feGaussianBlur stdDeviation="2"></feGaussianBlur>
                            <feComposite in2="hardAlpha" operator="out"></feComposite>
                            <feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.25 0"></feColorMatrix>
                            <feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow_2_17"></feBlend>
                            <feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow_2_17" result="shape"></feBlend>
                        </filter>
                        <clipPath id="clip0_2_17">
                            <rect width="28.0702" height="28.0702" fill="white" transform="translate(0.403503 0.526367)"></rect>
                        </clipPath>
                    </defs>
                </svg>
            </button>
        </div>
        <div class="custom-dropdown" id="filterDropdown">
            <div class="filter-icon">
                <i class="fas fa-filter"></i>
            </div>
            <div class="dropdown-menu" id="dropdownMenu">
                <div class="dropdown-item active" data-value="all">All</div>
                <div class="dropdown-item" data-value="movie">Movies</div>
                <div class="dropdown-item" data-value="tv">Series</div>
            </div>
        </div>
    </div>

    <div class="mydict" id="toggleContainer">
        <div>
            <label>
                <input type="radio" name="radio" checked="" id="moviesToggle" />
                <span>Movies</span>
            </label>
            <label>
                <input type="radio" name="radio" id="seriesToggle" />
                <span>Series</span>
            </label>
            <label>
                <input type="radio" name="radio" id="animeToggle" />
                <span>Anime</span>
            </label>
            <label>
                <input type="radio" name="radio" id="dramaToggle" />
                <span>Drama</span>
            </label>
            <label>
                <input type="radio" name="radio" id="showsToggle" />
                <span>Shows</span>
            </label>
        </div>
    </div>

    <div class="video-container" id="videoContainer">
        <div class="video-wrapper">
            <iframe id="videoFrame" src="" allowfullscreen aria-label="Video Player"></iframe>
        </div>
        <button class="close-button" id="closeButton" aria-label="Close Video">×</button>
    </div>

    <div class="selector-container" id="selectorContainer" style="display: none;">
        <div class="server-selector-container">
            <select id="server-select" aria-label="Select Server">
                <option value="https://vidfast.pro" selected>Server 1</option>
                <option value="https://111movies.com">Server 2</option>
                <option value="https://vidsrc.cc/v2">Server 3</option>
                <option value="https://vidsrc.vip">Server 4</option>
                <option value="https://www.2embed.cc">Server 5</option>
                <option value="https://vidlink.pro">Server 6</option>
                <option value="https://embed.su">Server 7</option>
                <option value="https://player.smashy.stream">Server 8</option>
                <option value="https://vidsrc.cc/v3">Server 9</option>
                <option value="https://vidsrc.me">Server 10</option>
            </select>
        </div>
        <div class="season-episode-container">
            <select id="season-select" style="display: none;" aria-label="Select Season">
                <option value="">Select Season</option>
            </select>
            <select id="episode-select" style="display: none;" aria-label="Select Episode">
                <option value="">Select Episode</option>
            </select>
        </div>
    </div>

    <div class="results" id="resultsContainer"></div>

    <div class="no-results" id="noResultsMessage">No results found. Please try a different search.</div>

    <div class="pagination" id="paginationContainer" style="display: none;">
        <button id="prevPage" disabled>‹</button>
        <span id="pageInfo">Page 1</span>
        <button id="nextPage">›</button>
    </div>

    <div id="imageGallery" class="container"></div>

    <div class="loading-spinner" id="loadingSpinner" style="display: none;"></div>

    <button class="home-button" id="homeButton" aria-label="Home">
        <i class="fas fa-home"></i>
    </button>

    <footer>
        <a href="https://github.com/ChocoCooper" class="footer-link" target="_blank" aria-label="Visit Choco Cooper's GitHub Profile">
            © Choco Cooper
            <i class="fa-brands fa-github github-icon" aria-hidden="true"></i>
        </a>
    </footer>

    <script>
        const resultsContainer = document.getElementById('resultsContainer');
        const videoFrame = document.getElementById('videoFrame');
        const videoContainer = document.getElementById('videoContainer');
        const searchQueryInput = document.getElementById('searchQuery');
        const searchButton = document.getElementById('searchButton');
        const imageContainer = document.getElementById('imageGallery');
        const closeButton = document.getElementById('closeButton');
        const moviesToggle = document.getElementById('moviesToggle');
        const seriesToggle = document.getElementById('seriesToggle');
        const animeToggle = document.getElementById('animeToggle');
        const dramaToggle = document.getElementById('dramaToggle');
        const showsToggle = document.getElementById('showsToggle');
        const filterDropdown = document.getElementById('filterDropdown');
        const dropdownMenu = document.getElementById('dropdownMenu');
        const selectorContainer = document.getElementById('selectorContainer');
        const seasonSelect = document.getElementById('season-select');
        const episodeSelect = document.getElementById('episode-select');
        const serverSelect = document.getElementById('server-select');
        const toggleContainer = document.getElementById('toggleContainer');
        const loadingSpinner = document.getElementById('loadingSpinner');
        const paginationContainer = document.getElementById('paginationContainer');
        const prevPageButton = document.getElementById('prevPage');
        const nextPageButton = document.getElementById('nextPage');
        const pageInfo = document.getElementById('pageInfo');
        const homeButton = document.getElementById('homeButton');
        const noResultsMessage = document.getElementById('noResultsMessage');

        let currentMediaType = 'movie';
        let currentMediaId = null;
        let currentPage = 1;
        let totalPages = 1;
        const resultsPerPage = 12;
        let currentFilter = 'all';
        let currentSearchResults = [];
        let lastSearchQuery = '';

        document.addEventListener('DOMContentLoaded', () => {
            const urlParams = new URLSearchParams(window.location.search);
            const searchQuery = urlParams.get('s');
            const page = urlParams.get('page');
            const tmdbId = window.location.pathname.split('/').pop();
            
            if (page) {
                currentPage = parseInt(page) || 1;
            }
            
            if (searchQuery) {
                searchQueryInput.value = decodeURIComponent(searchQuery);
                search();
            } else if (tmdbId && !isNaN(tmdbId)) {
                loadMediaItemDirectly(tmdbId);
            } else {
                fetchTrending('movie');
            }
        });

        window.addEventListener('popstate', () => {
            const urlParams = new URLSearchParams(window.location.search);
            const searchQuery = urlParams.get('s');
            const page = urlParams.get('page');
            const tmdbId = window.location.pathname.split('/').pop();
            
            if (page) {
                currentPage = parseInt(page) || 1;
            }
            
            if (searchQuery) {
                searchQueryInput.value = decodeURIComponent(searchQuery);
                search();
            } else if (tmdbId && !isNaN(tmdbId)) {
                loadMediaItemDirectly(tmdbId);
            } else {
                videoContainer.style.display = 'none';
                videoFrame.src = '';
                hideSelectors();
                imageContainer.style.display = 'grid';
                showToggle();
                resetDropdowns();
                homeButton.style.display = 'none';
                paginationContainer.style.display = 'none';
                resultsContainer.innerHTML = '';
                searchQueryInput.value = '';
                currentPage = 1;
            }
        });

        async function loadMediaItemDirectly(tmdbId) {
            const apiKey = 'ea118e768e75a1fe3b53dc99c9e4de09';
            try {
                let response = await fetch(`https://api.themoviedb.org/3/movie/${tmdbId}?api_key=${apiKey}`);
                let data = await response.json();
                
                if (data.success === false) {
                    response = await fetch(`https://api.themoviedb.org/3/tv/${tmdbId}?api_key=${apiKey}`);
                    data = await response.json();
                    if (data.success === false) {
                        throw new Error('Media not found');
                    }
                    handleSeriesClick(tmdbId, 'tv');
                } else {
                    handleSeriesClick(tmdbId, 'movie');
                }
            } catch (error) {
                console.error('Error loading media:', error);
                window.location.href = '/';
            }
        }

        function navigateToMedia(tmdbId, mediaType) {
            window.history.pushState({}, '', `/${tmdbId}`);
            handleSeriesClick(tmdbId, mediaType);
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function hideToggle() {
            toggleContainer.style.display = 'none';
        }

        function showToggle() {
            toggleContainer.style.display = 'block';
        }

        function hideSelectors() {
            selectorContainer.style.display = 'none';
            seasonSelect.style.display = 'none';
            episodeSelect.style.display = 'none';
        }

        function showSelectors() {
            selectorContainer.style.display = 'flex';
            if (currentMediaType === 'tv' || currentMediaType === 'anime' || currentMediaType === 'drama' || currentMediaType === 'shows') {
                seasonSelect.style.display = 'block';
                episodeSelect.style.display = 'block';
            } else {
                seasonSelect.style.display = 'none';
                episodeSelect.style.display = 'none';
            }
        }

        function clearSearchText() {
            searchQueryInput.value = '';
        }

        function resetDropdowns() {
            seasonSelect.innerHTML = '<option value="">Select Season</option>';
            episodeSelect.innerHTML = '<option value="">Select Episode</option>';
            serverSelect.selectedIndex = 0;
        }

        function handleSeriesClick(mediaId, mediaType) {
            currentMediaId = mediaId;
            currentMediaType = mediaType;
            resetDropdowns();
            videoFrame.src = '';
            videoContainer.style.display = 'block';

            serverSelect.selectedIndex = 0;

            if (mediaType === 'movie') {
                embedVideo(mediaId, 'movie');
            } else if (mediaType === 'tv' || mediaType === 'anime' || currentMediaType === 'drama' || currentMediaType === 'shows') {
                fetchSeasons(mediaId);
            }

            showSelectors();
            imageContainer.style.display = 'none';
            homeButton.style.display = 'block';
            paginationContainer.style.display = 'none';
            hideToggle();
        }

        homeButton.addEventListener('click', () => {
            window.history.pushState({}, '', '/');
            videoContainer.style.display = 'none';
            videoFrame.src = '';
            hideSelectors();
            imageContainer.style.display = 'grid';
            showToggle();
            resetDropdowns();
            homeButton.style.display = 'none';
            paginationContainer.style.display = 'none';
            currentPage = 1;
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        searchQueryInput.addEventListener('keypress', function(event) {
            if (event.key === 'Enter') {
                hideToggle();
                currentPage = 1;
                search();
            }
        });

        searchButton.addEventListener('click', () => {
            hideToggle();
            currentPage = 1;
            search();
        });

        closeButton.addEventListener('click', () => {
            window.history.pushState({}, '', '/');
            videoContainer.style.display = 'none';
            videoFrame.src = '';
            hideSelectors();
            imageContainer.style.display = 'grid';
            showToggle();
            resetDropdowns();
            homeButton.style.display = 'none';
            paginationContainer.style.display = 'none';
            currentPage = 1;
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        moviesToggle.addEventListener('change', () => {
            if (moviesToggle.checked) {
                currentMediaType = 'movie';
                hideSelectors();
                fetchTrending('movie');
            }
        });

        seriesToggle.addEventListener('change', () => {
            if (seriesToggle.checked) {
                currentMediaType = 'tv';
                fetchTrending('tv');
            }
        });

        animeToggle.addEventListener('change', () => {
            if (animeToggle.checked) {
                currentMediaType = 'anime';
                fetchTrending('anime');
            }
        });

        dramaToggle.addEventListener('change', () => {
            if (dramaToggle.checked) {
                currentMediaType = 'drama';
                fetchTrending('drama');
            }
        });

        showsToggle.addEventListener('change', () => {
            if (showsToggle.checked) {
                currentMediaType = 'shows';
                fetchTrending('shows');
            }
        });

        filterDropdown.addEventListener('click', (event) => {
            event.stopPropagation();
            dropdownMenu.classList.toggle('show');
        });

        document.addEventListener('click', (event) => {
            if (!filterDropdown.contains(event.target)) {
                dropdownMenu.classList.remove('show');
            }
        });

        dropdownMenu.querySelectorAll('.dropdown-item').forEach(item => {
            item.addEventListener('click', () => {
                dropdownMenu.querySelectorAll('.dropdown-item').forEach(i => {
                    i.classList.remove('active');
                });

                item.classList.add('active');
                currentFilter = item.getAttribute('data-value');
                dropdownMenu.classList.remove('show');
                currentPage = 1;
                const query = searchQueryInput.value.trim();
                if (query) {
                    search();
                }
            });
        });

        seasonSelect.addEventListener('change', async () => {
            const seasonNumber = seasonSelect.value;
            if (seasonNumber && currentMediaId) {
                await fetchEpisodes(currentMediaId, seasonNumber);
            }
        });

        episodeSelect.addEventListener('change', () => {
            const episodeNumber = episodeSelect.value;
            if (episodeNumber && currentMediaId) {
                const seasonNumber = seasonSelect.value;
                embedVideo(currentMediaId, currentMediaType, seasonNumber, episodeNumber);
            }
        });

        serverSelect.addEventListener('change', () => {
            if (currentMediaId) {
                if (currentMediaType === 'movie') {
                    embedVideo(currentMediaId, 'movie');
                } else if (currentMediaType === 'tv' || currentMediaType === 'anime' || currentMediaType === 'drama' || currentMediaType === 'shows') {
                    embedVideo(currentMediaId, 'tv', seasonSelect.value, episodeSelect.value);
                }
            }
        });

        prevPageButton.addEventListener('click', () => {
            if (currentPage > 1) {
                currentPage--;
                displayCurrentPageResults();
            }
        });

        nextPageButton.addEventListener('click', () => {
            if (currentPage < totalPages) {
                currentPage++;
                displayCurrentPageResults();
            }
        });

        async function fetchTrending(mediaType) {
            const apiKey = 'ea118e768e75a1fe3b53dc99c9e4de09';
            let url;

            if (mediaType === 'movie') {
                url = `https://api.themoviedb.org/3/trending/movie/day?api_key=${apiKey}`;
            } else if (mediaType === 'tv') {
                url = `https://api.themoviedb.org/3/trending/tv/day?api_key=${apiKey}`;
            } else if (mediaType === 'anime') {
                url = `https://api.themoviedb.org/3/discover/tv?api_key=${apiKey}&with_genres=16&sort_by=popularity.desc&with_original_language=ja`;
            } else if (mediaType === 'drama') {
                url = `https://api.themoviedb.org/3/discover/tv?api_key=${apiKey}&with_genres=18&sort_by=popularity.desc&with_original_language=ko`;
            } else if (mediaType === 'shows') {
                url = `https://api.themoviedb.org/3/discover/tv?api_key=${apiKey}&with_genres=10764&sort_by=popularity.desc&with_original_language=en`;
            }

            try {
                const response = await fetch(url);
                const data = await response.json();
                const trendingContent = data.results || [];

                imageContainer.innerHTML = '';

                const englishContent = trendingContent.filter(item => {
                    const title = item.title || item.name || '';
                    const isEnglish = /^[a-zA-Z0-9\s\-':,.!?"]+$/.test(title);
                    return title && isEnglish;
                });

                const limitedContent = englishContent.slice(0, 12);

                limitedContent.forEach(item => {
                    const imageUrl = item.poster_path ? `https://image.tmdb.org/t/p/w500${item.poster_path}` : null;
                    if (imageUrl) {
                        const itemDiv = document.createElement('div');
                        itemDiv.className = 'gallery-item';
                        itemDiv.tabIndex = 0;
                        itemDiv.innerHTML = `
                            <img src="${imageUrl}" alt="${item.title || item.name}" />
                            <p>${item.title || item.name}</p>
                            <p class="release-date">(${new Date(item.release_date || item.first_air_date).getFullYear()})</p>
                        `;
                        itemDiv.onclick = () => {
                            navigateToMedia(item.id, mediaType);
                        };
                        itemDiv.addEventListener('keydown', (event) => {
                            if (event.key === 'Enter') {
                                navigateToMedia(item.id, mediaType);
                            }
                        });
                        imageContainer.appendChild(itemDiv);
                    }
                });
            } catch (error) {
                console.error('Error fetching trending content:', error);
            }
        }

        async function search() {
            const query = searchQueryInput.value.trim();
            
            if (query !== lastSearchQuery) {
                currentPage = 1;
            }
            lastSearchQuery = query;
            
            resultsContainer.innerHTML = '';
            noResultsMessage.style.display = 'none';

            loadingSpinner.style.display = 'block';
            imageContainer.style.display = 'none';
            videoContainer.style.display = 'none';
            paginationContainer.style.display = 'none';
            hideSelectors();
            hideToggle();

            if (!query) {
                loadingSpinner.style.display = 'none';
                imageContainer.style.display = 'grid';
                showToggle();
                return;
            }

            const apiKey = 'ea118e768e75a1fe3b53dc99c9e4de09';
            currentFilter = dropdownMenu.querySelector('.dropdown-item.active')?.getAttribute('data-value') || 'all';

            window.history.pushState({}, '', `/?s=${encodeURIComponent(query)}&page=${currentPage}`);

            try {
                let movieData = { results: [], total_pages: 0 };
                let seriesData = { results: [], total_pages: 0 };
                let animeData = { results: [], total_pages: 0 };
                let dramaData = { results: [], total_pages: 0 };
                let showsData = { results: [], total_pages: 0 };

                if (currentFilter === 'all' || currentFilter === 'movie') {
                    const movieResponse = await fetch(`https://api.themoviedb.org/3/search/movie?api_key=${apiKey}&query=${encodeURIComponent(query)}&page=${currentPage}`);
                    movieData = await movieResponse.json();
                }

                if (currentFilter === 'all' || currentFilter === 'tv') {
                    const seriesResponse = await fetch(`https://api.themoviedb.org/3/search/tv?api_key=${apiKey}&query=${encodeURIComponent(query)}&page=${currentPage}`);
                    seriesData = await seriesResponse.json();
                }

                if (currentFilter === 'all') {
                    const animeResponse = await fetch(`https://api.themoviedb.org/3/search/tv?api_key=${apiKey}&query=${encodeURIComponent(query)}&with_genres=16&with_original_language=ja&page=${currentPage}`);
                    animeData = await animeResponse.json();
                    
                    const dramaResponse = await fetch(`https://api.themoviedb.org/3/search/tv?api_key=${apiKey}&query=${encodeURIComponent(query)}&with_genres=18&with_original_language=ko|zh&page=${currentPage}`);
                    dramaData = await dramaResponse.json();
                    
                    const showsResponse = await fetch(`https://api.themoviedb.org/3/search/tv?api_key=${apiKey}&query=${encodeURIComponent(query)}&with_genres=10764&with_original_language=en&page=${currentPage}`);
                    showsData = await showsResponse.json();
                }

                currentSearchResults = [
                    ...movieData.results.map(result => ({ ...result, mediaType: 'movie' })),
                    ...seriesData.results.map(result => ({ ...result, mediaType: 'tv' })),
                    ...animeData.results.map(result => ({ ...result, mediaType: 'anime' })),
                    ...dramaData.results.map(result => ({ ...result, mediaType: 'drama' })),
                    ...showsData.results.map(result => ({ ...result, mediaType: 'shows' })),
                ];

                const uniqueResults = [];
                const seenIds = new Set();

                currentSearchResults.forEach(result => {
                    if (!seenIds.has(result.id)) {
                        seenIds.add(result.id);
                        uniqueResults.push(result);
                    }
                });

                const filteredResults = uniqueResults.filter(result => {
                    const title = result.title || result.name || '';
                    const hasTitle = title.trim() !== '';
                    const isEnglish = /^[a-zA-Z0-9\s\-':,.!?"]+$/.test(title);
                    const hasPoster = result.poster_path;
                    const year = new Date(result.release_date || result.first_air_date).getFullYear();
                    return hasTitle && isEnglish && hasPoster && !isNaN(year);
                });

                if (filteredResults.length === 0) {
                    resultsContainer.innerHTML = '';
                    imageContainer.style.display = 'none';
                    noResultsMessage.style.display = 'block';
                    loadingSpinner.style.display = 'none';
                    return;
                }

                const lowerQuery = query.toLowerCase();
                filteredResults.sort((a, b) => {
                    const aTitle = (a.title || a.name || '').toLowerCase();
                    const bTitle = (b.title || b.name || '').toLowerCase();
                    
                    const aScore = calculateMatchScore(aTitle, lowerQuery, a.popularity);
                    const bScore = calculateMatchScore(bTitle, lowerQuery, b.popularity);
                    
                    return bScore - aScore;
                });

                currentSearchResults = filteredResults;
                totalPages = Math.ceil(currentSearchResults.length / resultsPerPage);

                displayCurrentPageResults();
                loadingSpinner.style.display = 'none';
                
                if (totalPages > 1) {
                    paginationContainer.style.display = 'flex';
                }
            } catch (error) {
                console.error('Error fetching data:', error);
                resultsContainer.innerHTML = '';
                loadingSpinner.style.display = 'none';
                noResultsMessage.style.display = 'block';
            }
        }

        function displayCurrentPageResults() {
            resultsContainer.innerHTML = '';
            noResultsMessage.style.display = 'none';
            
            const startIndex = (currentPage - 1) * resultsPerPage;
            const endIndex = startIndex + resultsPerPage;
            const resultsToShow = currentSearchResults.slice(startIndex, endIndex);

            if (resultsToShow.length === 0) {
                noResultsMessage.style.display = 'block';
                return;
            }

            resultsToShow.forEach(result => {
                const item = document.createElement('div');
                item.className = 'result-item';
                item.tabIndex = 0;
                const imageUrl = result.poster_path ? `https://image.tmdb.org/t/p/w500${result.poster_path}` : null;
                if (imageUrl) {
                    item.innerHTML = `
                        <img src="${imageUrl}" alt="${result.title || result.name}" />
                        <p>${result.title || result.name}</p>
                        <p class="release-date">(${new Date(result.release_date || result.first_air_date).getFullYear()})</p>
                    `;
                    item.onclick = () => {
                        clearSearchText();
                        navigateToMedia(result.id, result.mediaType);
                        resultsContainer.innerHTML = '';
                    };
                    item.addEventListener('keydown', (event) => {
                        if (event.key === 'Enter') {
                            clearSearchText();
                            navigateToMedia(result.id, result.mediaType);
                            resultsContainer.innerHTML = '';
                        }
                    });
                    resultsContainer.appendChild(item);
                }
            });

            updatePagination();
            window.history.pushState({}, '', `/?s=${encodeURIComponent(searchQueryInput.value.trim())}&page=${currentPage}`);
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function calculateMatchScore(title, query, popularity) {
            let score = 0;
            popularity = popularity || 0;
            
            if (title === query) {
                score += 1000;
            }
            
            if (title.startsWith(query)) {
                score += 500 + (query.length / title.length * 100);
            }
            
            if (title.includes(query)) {
                score += 300 + (query.length / title.length * 50);
            }
            
            const words = query.split(/\s+/);
            words.forEach(word => {
                if (title.includes(word)) {
                    score += 100 + (word.length / title.length * 20);
                }
                
                const wordRegex = new RegExp(`\\b${word}\\b`, 'i');
                if (wordRegex.test(title)) {
                    score += 50;
                }
            });
            
            score += popularity / 100;
            score -= title.length / 1000;
            
            return score;
        }

        function updatePagination() {
            pageInfo.textContent = `Page ${currentPage} of ${totalPages}`;
            prevPageButton.disabled = currentPage === 1;
            nextPageButton.disabled = currentPage === totalPages;
            prevPageButton.style.display = 'block';
            nextPageButton.style.display = 'block';
        }

        function embedVideo(mediaId, mediaType, seasonNumber = null, episodeNumber = null) {
            hideToggle();
            const selectedServer = serverSelect.value;
            let embedUrl;

            if (mediaType === 'movie') {
                switch (selectedServer) {
                    case 'https://www.2embed.stream':
                        embedUrl = `${selectedServer}/embed/movie/${mediaId}`;
                        break;
                    case 'https://www.2embed.cc':
                        embedUrl = `${selectedServer}/embed/${mediaId}`;
                        break;
                    case 'https://vidsrc.cc/v2':
                    case 'https://vidsrc.cc/v3':
                        embedUrl = `${selectedServer}/embed/movie/${mediaId}`;
                        break;
                    case 'https://vidlink.pro':
                        embedUrl = `${selectedServer}/movie/${mediaId}`;
                        break;
                    case 'https://embed.su':
                        embedUrl = `${selectedServer}/embed/movie/${mediaId}`;
                        break;
                    case 'https://player.smashy.stream':
                        embedUrl = `${selectedServer}/movie/${mediaId}`;
                        break;
                    case 'https://vidfast.pro':
                        embedUrl = `${selectedServer}/movie/${mediaId}`;
                        break;
                    case 'https://111movies.com':
                        embedUrl = `${selectedServer}/movie/${mediaId}`;
                        break;
                    default:
                        embedUrl = `${selectedServer}/embed/${mediaType}/${mediaId}`;
                        break;
                }
            } else if (mediaType === 'tv' && seasonNumber && episodeNumber) {
                switch (selectedServer) {
                    case 'https://www.2embed.stream':
                        embedUrl = `${selectedServer}/embed/tv/${mediaId}/${seasonNumber}/${episodeNumber}`;
                        break;
                    case 'https://www.2embed.cc':
                        embedUrl = `${selectedServer}/embedtv/${mediaId}&s=${seasonNumber}&e=${episodeNumber}`;
                        break;
                    case 'https://vidsrc.cc/v2':
                    case 'https://vidsrc.cc/v3':
                        embedUrl = `${selectedServer}/embed/tv/${mediaId}/${seasonNumber}/${episodeNumber}`;
                        break;
                    case 'https://vidlink.pro':
                        embedUrl = `${selectedServer}/tv/${mediaId}/${seasonNumber}/${episodeNumber}`;
                        break;
                    case 'https://embed.su':
                        embedUrl = `${selectedServer}/embed/tv/${mediaId}/${seasonNumber}/${episodeNumber}`;
                        break;
                    case 'https://player.smashy.stream':
                        embedUrl = `${selectedServer}/tv/${mediaId}?s=${seasonNumber}&e=${episodeNumber}`;
                        break;
                    case 'https://vidfast.pro':
                        embedUrl = `${selectedServer}/tv/${mediaId}/${seasonNumber}/${episodeNumber}`;
                        break;
                    case 'https://111movies.com':
                        embedUrl = `${selectedServer}/tv/${mediaId}/${seasonNumber}/${episodeNumber}`;
                        break;
                    default:
                        embedUrl = `${selectedServer}/embed/${mediaType}/${mediaId}/${seasonNumber}/${episodeNumber}`;
                        break;
                }
            } else {
                videoFrame.src = '';
                videoContainer.style.display = 'block';
                return;
            }

            videoFrame.src = embedUrl;
            videoContainer.style.display = 'block';
            resultsContainer.innerHTML = '';
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        async function fetchSeasons(mediaId) {
            const apiKey = 'ea118e768e75a1fe3b53dc99c9e4de09';
            const url = `https://api.themoviedb.org/3/tv/${mediaId}?api_key=${apiKey}`;

            try {
                const response = await fetch(url);
                const data = await response.json();
                const seasons = data.seasons || [];

                seasonSelect.innerHTML = '<option value="">Select Season</option>';
                seasons.forEach(season => {
                    if (season.season_number > 0) {
                        const option = document.createElement('option');
                        option.value = season.season_number;
                        option.textContent = `Season ${season.season_number}`;
                        seasonSelect.appendChild(option);
                    }
                });

                showSelectors();
            } catch (error) {
                console.error('Error fetching seasons:', error);
            }
        }

        async function fetchEpisodes(mediaId, seasonNumber) {
            const apiKey = 'ea118e768e75a1fe3b53dc99c9e4de09';
            const url = `https://api.themoviedb.org/3/tv/${mediaId}/season/${seasonNumber}?api_key=${apiKey}`;

            try {
                const response = await fetch(url);
                const data = await response.json();
                const episodes = data.episodes || [];

                episodeSelect.innerHTML = '<option value="">Select Episode</option>';
                episodes.forEach(episode => {
                    const option = document.createElement('option');
                    option.value = episode.episode_number;
                    option.textContent = `Episode ${episode.episode_number}`;
                    episodeSelect.appendChild(option);
                });
            } catch (error) {
                console.error('Error fetching episodes:', error);
            }
        }
    </script>
</body>
</html>
